## 1. 概要

### 1.1. 目的

- 来場者の行動データを収集・分析し、今後のイベント企画に活用する。
- スタンプラリー機能を通じて、来場者に各展示を巡る楽しさとメリットを提供し、回遊性を高める。
- リアルタイムの混雑状況を可視化し、来場者の快適な移動をサポートする。

### 1.2. 対象イベント

- 高校の文化祭

---

## 2. システム利用者と役割

| 役割 | 説明 |
| --- | --- |
| **来場者** | 一般の参加者。スマートフォンで各種機能を利用する。 |
| **クラス担当者** | 各クラスの展示担当者。来場者のスタンプを付与する。 |
| **執行部** | イベント運営の中心メンバー。クーポン管理やデータ確認を行う。 |
| **本部** | 教師や運営責任者。全体の状況をリアルタイムで把握する。 |
| **システム管理者** | システム全体の最高権限者。全データの管理・編集を行う。 |

---

## 3. 機能要件

### 3.1. 来場者向け機能 (PWA)

- **PWA (Progressive Web App) 対応**
    - **オフライン対応:** 一度アクセスすると、マップ、スケジュール等の主要コンテンツを端末にキャッシュ。電波の悪い場所でも基本的な情報を閲覧でき、自身のQRコードも表示可能。
    - **ホーム画面追加:** アプリのようにスマートフォンのホーム画面へ追加でき、素早くアクセスできる。
- **ユーザーID管理**
    - 初回アクセス時にアンケート（属性、年齢層など）に回答後、ユニークなIDを生成し、端末の`localStorage`に保存。これによりブラウザを閉じてもログイン状態を維持する。
    - IDに基づいた個人用のQRコードを画面に表示する。
    - 校内マップを表示し、フロア/エリア（2F, 3F, 模擬店など）ごとに表示を切り替えられる。
- **マップ機能**
- **スケジュール機能**
    - 場所（中庭, アリーナなど）ごとにタイムスケジュールを一覧表示できる。
- **スタンプラリー機能**
    - **自動コース判定:** 各クラスでスタンプを集めていくと、システムが自動で「Aコース達成」などを判定し、画面に反映する。来場者がコースを選択する必要はない。
    - **リアルタイム更新:** クラス担当者にQRコードを読み取ってもらうと、即座に自身のスタンプ獲得状況が画面に自動で更新される。
    - **クーポン引換:** コースを達成すると、クーポン引換用のユニークなコードが画面に表示される。
- **アンケート機能**
    - 来場者の属性を確認するために、年代、性別、住んでいる市区町村を答えないといけないようにする。
    - 一番良い展示を行った展示の中から、投票できるようにする
- **その他**
    - お知らせ機能: 管理者からの通知を閲覧できる。
    - 混雑状況確認機能: 各エリアの混雑度（例：空いている, 普通, 混雑）をマップ上で確認できる。

### 3.2. 管理者向け機能 (管理画面)

- **ログイン**
    - 来場者向けアプリとは完全に分離された、専用のログインページから各権限に応じたアカウントでログインする。
- **ダッシュボード（本部・システム管理者向け）**
    - 各種データをグラフで視覚的に表示（来場者属性、クラス別来場者数、時間帯別推移など）。
    - データをExcel/スプレッドシート形式でエクスポートできる。
- **スタンプ付与（クラス担当者向け）**
    - 来場者のQRコードをiPad等で読み取る。
    - 読み取れない場合のため、ID（番号）の手入力でもスタンプを付与できる。
- **コンテンツ管理（執行部・システム管理者向け）**
    - **スタンプ画像管理:** 各クラスのスタンプ画像を管理画面から簡単にアップロード・変更できる。
    - **スタンプラリーコース管理:** スタンプの組み合わせによるコース（例: Aコース = {1-A, 2-B, 3-C}）を、管理画面から自由に作成・編集できる。
    - **スケジュール管理:** イベントのスケジュールを簡単に追加・編集・削除できる。
    - **お知らせ管理:** 来場者向けに新しいお知らせを配信できる。
- **その他**
    - **クーポン発行（執行部向け）:** 引換用コードを照合し、使用済みに変更する。
    - **ユーザー情報管理（権限に応じる）:** ユーザーの行動履歴などを確認できる。

---

## 4. 非機能要件

- **混雑状況の推定ロジック**
    - スタンプ付与時点で、その教室の「推定滞在者数」を+1する。
    - スタンプ付与から**10分**経過後、自動的に-1する。
    - 「累計来場者数」はリセットせず、加算のみを行う。
- **UI/UX**
    - 全ての画面において、動作が軽量で、直感的かつ分かりやすいデザインを採用する。

---

## 5. 技術構成

本システムは、開発の速度、リアルタイム性、当日の安定性を最大限に高めるため、以下のモダンな技術構成を採用します。

- **フロントエンド:** **Vue.js** (PWAとして実装)
    - ユーザーが直接触れる画面を構築します。インタラクティブで使いやすいUIを実現します。
- **バックエンド基盤:** **Firebase (Google)**
    - サーバー構築やデータベース管理の手間を大幅に削減できる、Googleの提供するサービス群です。これにより、アプリケーション本体の機能開発に集中できます。

### Firebaseの具体的な役割

| Firebaseサービス | 役割 | 説明 |
| --- | --- | --- |
| **Firestore** | **リアルタイムデータベース** | 全てのデータ（ユーザー情報、スタンプ状況など）を保存します。**最大の特徴は、データが更新されると、アプリの画面が自動的に更新される機能を持つことです。** これにより、「スタンプを押したら即座に画面に反映される」といったリアルタイム体験を簡単に実現できます。 |
| **Authentication** | **認証システム** | 管理者（クラス担当、執行部など）のログイン機能を安全かつ簡単に実装します。メールアドレスとパスワードでの認証などを手軽に導入できます。 |
| **Cloud Functions** | **サーバー処理** | 「スタンプ付与から10分経過したら滞在者数を-1する」といった、サーバー側で自動的に実行したい処理を担当します。プログラムを配置するだけで、サーバーの管理は不要です。 |
| **Hosting** | **Webサイト公開** | 作成した来場者向けアプリ(PWA)をインターネット上に公開します。高速な配信と簡単なデプロイが可能です。 |
| **Cloud Storage** | **ファイルストレージ** | スタンプ画像など、ユーザーがアップロードするファイルを保存します。 |

### この構成を選ぶメリット

- **開発スピードの向上:** サーバーやデータベースの構築・管理が不要になり、開発期間を大幅に短縮できます。
- **強力なリアルタイム機能:** 複雑な実装なしで、スタンプラリーの状況などをリアルタイムに反映できます。
- **高い安定性と拡張性:** Googleの堅牢なインフラ上で動作するため、文化祭当日のアクセス集中にも安定して対応できます。
- **コスト効率:** 無料利用枠が広く、文化祭の規模であれば追加費用なしで運用できる可能性が高いです。
